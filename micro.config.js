const dispatch = require('micro-route/dispatch')
const cache = require('micro-cacheable')
const {send} = require('micro')
const api = require('./api/')
const nuxt = require('./nuxt.index.js')

module.exports = dispatch()
	.dispatch('/api/kinds', ['GET'], async (req, res) => send(res, 200, await api.getKinds()))
	.dispatch('/api/kinds/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getKind(params.code)))
	.dispatch('/api/islands', ['GET'], async (req, res) => send(res, 200, await api.getIslands()))
	.dispatch('/api/islands/regions', ['GET'], async (req, res) => send(res, 200, await api.getIslandsRegions()))
	.dispatch('/api/islands/regions/zones', ['GET'], async (req, res) => send(res, 200, await api.getIslandsRegionsZones()))
  .dispatch('/api/islands/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getIsland(params.code)))
	.dispatch('/api/parts', ['GET'], async (req, res) => send(res, 200, await api.getParts()))
  .dispatch('/api/parts/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getPart(params.code)))
	.dispatch('/api/regions', ['GET'], async (req, res) => send(res, 200, await api.getRegions()))
	.dispatch('/api/regions/zones', ['GET'], async (req, res) => send(res, 200, await api.getRegionsZones()))
  .dispatch('/api/regions/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getRegion(params.code)))
  .dispatch('/api/regions/:code/zones', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getRegionZones(params.code)))
	.dispatch('/api/speakers', ['GET'], async (req, res) => send(res, 200, await api.getSpeakers()))
  .dispatch('/api/speakers/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getSpeaker(params.code)))
	.dispatch('/api/zones', ['GET'], async (req, res) => send(res, 200, await api.getZones()))
  .dispatch('/api/zones/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getZone(params.code)))
	.dispatch('/api/suggestions', ['GET'], async (req, res) => send(res, 200, await api.getSuggestions()))
  .dispatch('*', ['GET'], (req, res) => nuxt.render(req, res))
