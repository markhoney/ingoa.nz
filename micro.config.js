const dispatch = require('micro-route/dispatch')
const {send} = require('micro')
const api = require('./api/')
const nuxt = require('./nuxt.index.js')

module.exports = dispatch()
	.dispatch('/api/kind', ['GET'], async (req, res) => send(res, 200, await api.getKinds()))
	.dispatch('/api/kind/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getKind(params.code)))
	.dispatch('/api/island', ['GET'], async (req, res) => send(res, 200, await api.getIslands()))
  .dispatch('/api/island/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getIsland(params.code)))
	.dispatch('/api/part', ['GET'], async (req, res) => send(res, 200, await api.getParts()))
  .dispatch('/api/part/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getPart(params.code)))
	.dispatch('/api/region', ['GET'], async (req, res) => send(res, 200, await api.getRegions()))
  .dispatch('/api/region/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getRegion(params.code)))
	.dispatch('/api/speaker', ['GET'], async (req, res) => send(res, 200, await api.getSpeakers()))
  .dispatch('/api/speaker/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getSpeaker(params.code)))
	.dispatch('/api/zone', ['GET'], async (req, res) => send(res, 200, await api.getZones()))
  .dispatch('/api/zone/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getZone(params.code)))
	.dispatch('/api/suggestion', ['GET'], async (req, res) => send(res, 200, await api.getSuggestions()))
  .dispatch('*', ['GET'], (req, res) => nuxt.render(req, res))
