const dispatch = require('micro-route/dispatch')
const cache = require('micro-cacheable')
const {send} = require('micro')
const api = require('./api/')
const nuxt = require('./nuxt.index.js')

module.exports = dispatch()
	.dispatch('/api/kinds', ['GET'], async (req, res) => send(res, 200, await api.getKinds()))
	.dispatch('/api/kinds/:kind', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getKind(params.kind)))
	.dispatch('/api/islands', ['GET'], async (req, res) => send(res, 200, await api.getIslands()))
	.dispatch('/api/islands/regions', ['GET'], async (req, res) => send(res, 200, await api.getIslandsRegions()))
	.dispatch('/api/islands/regions/zones', ['GET'], async (req, res) => send(res, 200, await api.getIslandsRegionsZones()))
	.dispatch('/api/islands/:island', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getIsland(params.island)))
	.dispatch('/api/islands/:island/regions', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getIslandRegions(params.island)))
	.dispatch('/api/islands/:island/regions/zones', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getIslandRegionsZones(params.island)))
	.dispatch('/api/parts', ['GET'], async (req, res) => send(res, 200, await api.getParts()))
  .dispatch('/api/parts/:part', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getPart(params.part)))
	.dispatch('/api/regions', ['GET'], async (req, res) => send(res, 200, await api.getRegions()))
	.dispatch('/api/regions/zones', ['GET'], async (req, res) => send(res, 200, await api.getRegionsZones()))
  .dispatch('/api/regions/:region', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getRegion(params.region)))
  .dispatch('/api/regions/:region/zones', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getRegionZones(params.region)))
	.dispatch('/api/speakers', ['GET'], async (req, res) => send(res, 200, await api.getSpeakers()))
  .dispatch('/api/speakers/:speaker', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getSpeaker(params.speaker)))
	.dispatch('/api/zones', ['GET'], async (req, res) => send(res, 200, await api.getZones()))
  .dispatch('/api/zones/:code', ['GET'], async (req, res, {params, query}) => send(res, 200, await api.getZone(params.code)))
	.dispatch('/api/suggestions', ['GET'], async (req, res) => send(res, 200, await api.getSuggestions()))
  .dispatch('*', ['GET'], (req, res) => nuxt.render(req, res))
